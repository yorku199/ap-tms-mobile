# คู่มือการใช้งานแบบ Step-by-Step
## TMS Mobile Application

---

## 📱 1. การเช็คอินเข้างาน (Check-in)

### ขั้นตอนที่ 1: เปิดหน้าเช็คอิน
- จากหน้าหลัก กดปุ่ม "เช็คอิน" หรือเมนูที่เกี่ยวข้อง
- ระบบจะเปิดหน้าเช็คอินพร้อมแสดงแผนที่

### ขั้นตอนที่ 2: ตรวจสอบตำแหน่ง
- ระบบจะขออนุญาตเข้าถึงตำแหน่ง GPS
- อนุญาตให้เข้าถึงตำแหน่ง
- ระบบจะแสดงตำแหน่งปัจจุบันบนแผนที่

### ขั้นตอนที่ 3: ตรวจสอบระยะทาง
- ระบบจะคำนวณระยะทางจากตำแหน่งปัจจุบันไปยังบริษัท
- **ถ้าอยู่ในรัศมีที่กำหนด:**
  - ปุ่ม "เช็คอิน" จะพร้อมใช้งาน
  - แสดงระยะทาง (เช่น "ระยะทาง: 50 เมตร")
- **ถ้าอยู่นอกรัศมี:**
  - ปุ่ม "เช็คอิน" จะถูกปิดการใช้งาน
  - แสดงระยะทาง (เช่น "ระยะทาง: 500 เมตร")

### ขั้นตอนที่ 4: กดปุ่มเช็คอิน
- กดปุ่ม "เช็คอิน"
- ระบบจะบันทึกข้อมูล:
  - เวลาเช็คอิน
  - ตำแหน่ง GPS
  - ระยะทาง
  - อัพเดท `actual_in` หรือ `actual_out` ใน Job Routes (ถ้ามี)

### ขั้นตอนที่ 5: ดูผลลัพธ์
- ระบบจะแสดงข้อความสำเร็จ
- แสดงเวลาเช็คอินที่ด้านล่างของหน้าจอ
- **หมายเหตุ:** แสดงเฉพาะวันที่ปัจจุบันเท่านั้น

---

## 📋 2. การดู Job Orders

### ขั้นตอนที่ 1: เปิดหน้า Job Order
- จากหน้าหลัก กดปุ่ม "Job Order" หรือเมนูที่เกี่ยวข้อง
- ระบบจะโหลดข้อมูล Job Orders ของวันที่ปัจจุบัน

### ขั้นตอนที่ 2: ดู Timeline
- Timeline แสดงเป็นเส้นแนวตั้งทางซ้าย
- มีวงกลมแสดงแต่ละชั่วโมง (00:00 - 23:00)
- เส้นสีแดงแสดงเวลาปัจจุบัน
- Timeline จะเลื่อนอัตโนมัติไปที่เส้นเวลาปัจจุบัน

### ขั้นตอนที่ 3: ดู Job Routes
- Job Routes แสดงเป็นการ์ดบน Timeline
- แต่ละการ์ดแสดง:
  - ชื่อ Job
  - เวลา `plan_in` และ `plan_out`
  - เวลา `actual_in` และ `actual_out` (ถ้ามี)
  - สถานะเข้างานและออกงาน

### ขั้นตอนที่ 4: ดูสถานะ
- **สถานะเข้างาน:**
  - 🟢 เข้าตามเวลา (สีเขียว) - ตรงเวลา ±10 นาที
  - 🟠 เข้าก่อนเวลา (สีส้ม) - ก่อนเวลา >10 นาที
  - 🔴 เข้าสาย (สีแดง) - หลังเวลา >10 นาที

- **สถานะออกงาน:**
  - 🟢 ออกตามเวลา (สีเขียว) - ตรงเวลา ±10 นาที
  - 🟠 ออกก่อนเวลา (สีส้ม) - ก่อนหรือหลังเวลา >10 นาที

### ขั้นตอนที่ 5: ดู Check-in Times
- เวลาเช็คอินจาก `tb_check_in_job` แสดงเป็น badge สีแดง
- อยู่ใกล้เส้น Timeline แนวตั้งทางซ้าย
- แสดงข้อความ "เช็คอิน" พร้อมเวลา

### ขั้นตอนที่ 6: เลือกวันที่อื่น
- กดที่ปฏิทินด้านบน
- เลือกวันที่ที่ต้องการ
- ระบบจะโหลดข้อมูลใหม่ตามวันที่ที่เลือก

---

## 🔄 3. Flow การทำงานของระบบ

### Flow การเช็คอิน

```
┌─────────────────┐
│  เปิดหน้าเช็คอิน  │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  ขออนุญาต GPS   │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  ได้ตำแหน่ง GPS │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ คำนวณระยะทาง    │
└────────┬────────┘
         │
         ▼
    ┌────────┐
    │ อยู่ใน  │
    │ รัศมี? │
    └───┬────┘
        │
    ┌───┴───┐
    │       │
   ใช่      ไม่ใช่
    │       │
    ▼       ▼
┌────────┐ ┌──────────────┐
│ แสดง   │ │ แสดงระยะทาง  │
│ ปุ่ม   │ │ และปิดปุ่ม   │
│ เช็คอิน│ │ เช็คอิน      │
└───┬────┘ └──────────────┘
    │
    ▼
┌─────────────────┐
│  กดปุ่มเช็คอิน   │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ บันทึกข้อมูล     │
│ - เวลาเช็คอิน    │
│ - ตำแหน่ง GPS   │
│ - ระยะทาง       │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ อัพเดท actual_in │
│ หรือ actual_out  │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ แสดงผลสำเร็จ    │
└─────────────────┘
```

### Flow การแสดง Job Orders

```
┌─────────────────┐
│  เปิดหน้า Job    │
│     Order       │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ โหลดข้อมูลวันที่ │
│    ปัจจุบัน      │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ ดึงข้อมูล Job    │
│    Orders       │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ ดึงข้อมูล Check- │
│    in Times     │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ แสดง Timeline   │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ แสดง Job Routes │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ แสดง Check-in   │
│     Badges      │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ คำนวณและแสดง    │
│    สถานะ        │
└────────┬────────┘
         │
         ▼
    ┌────────┐
    │ เลือก  │
    │ วันที่? │
    └───┬────┘
        │
    ┌───┴───┐
    │       │
   ใช่      ไม่ใช่
    │       │
    ▼       ▼
┌────────┐ ┌──────────────┐
│ โหลด   │ │ แสดงข้อมูล   │
│ ข้อมูล  │ │ ปัจจุบัน     │
│ ใหม่   │ │              │
└────────┘ └──────────────┘
```

---

## 📊 4. การคำนวณสถานะ

### สถานะเข้างาน (Check-in Status)

```
actual_in และ plan_in มีค่า?
    │
    ├─ ไม่มี → ไม่แสดงสถานะ
    │
    └─ มี → คำนวณ diffMinutes = (actual_in - plan_in) ในหน่วยนาที
            │
            ├─ diffMinutes < -10 → "เข้าก่อนเวลา" (สีส้ม)
            │
            ├─ -10 ≤ diffMinutes ≤ 10 → "เข้าตามเวลา" (สีเขียว)
            │
            └─ diffMinutes > 10 → "เข้าสาย" (สีแดง)
```

### สถานะออกงาน (Check-out Status)

```
actual_out และ plan_out มีค่า?
    │
    ├─ ไม่มี → ไม่แสดงสถานะ
    │
    └─ มี → คำนวณ diffMinutes = (actual_out - plan_out) ในหน่วยนาที
            │
            ├─ diffMinutes < -10 → "ออกก่อนเวลา" (สีส้ม)
            │
            ├─ -10 ≤ diffMinutes ≤ 10 → "ออกตามเวลา" (สีเขียว)
            │
            └─ diffMinutes > 10 → "ออกก่อนเวลา" (สีส้ม)
```

---

## ⚠️ 5. หมายเหตุสำคัญ

1. **เวลาเช็คอิน/เช็คเอาท์:**
   - แสดงเฉพาะวันที่ปัจจุบันเท่านั้น
   - ถ้าวันนั้นไม่มีข้อมูล จะไม่แสดงอะไร

2. **การอัพเดท actual_in/actual_out:**
   - ระบบจะอัพเดทเฉพาะเมื่อ `checkInTime > planTime`
   - อัพเดทเฉพาะ Job Routes ของวันที่ปัจจุบัน

3. **Timeline Auto-scroll:**
   - Timeline จะเลื่อนอัตโนมัติไปที่เส้นเวลาปัจจุบัน
   - ใช้ตำแหน่งที่คำนวณจาก layout จริง

4. **การ Refresh ข้อมูล:**
   - หลังจากเช็คอิน ระบบจะ refresh Timeline อัตโนมัติ
   - เมื่อเลือกวันที่ใหม่ ระบบจะโหลดข้อมูลใหม่

---

## 🔧 6. การแก้ไขปัญหา

### ปัญหา: ไม่สามารถเช็คอินได้
**สาเหตุที่เป็นไปได้:**
- ไม่อยู่ในรัศมีที่กำหนด
- ไม่ได้รับอนุญาตเข้าถึง GPS
- ไม่มีการเชื่อมต่ออินเทอร์เน็ต

**วิธีแก้ไข:**
1. ตรวจสอบว่าอยู่ในรัศมีหรือไม่
2. อนุญาตให้เข้าถึงตำแหน่ง GPS
3. ตรวจสอบการเชื่อมต่ออินเทอร์เน็ต

### ปัญหา: ไม่แสดงข้อมูลเช็คอินบน Timeline
**สาเหตุที่เป็นไปได้:**
- เช็คอินในวันที่อื่น (ไม่ใช่วันปัจจุบัน)
- ข้อมูลยังไม่ถูกบันทึก

**วิธีแก้ไข:**
1. ตรวจสอบว่าเช็คอินในวันที่ปัจจุบันหรือไม่
2. Refresh หน้า Job Order
3. ตรวจสอบการเชื่อมต่ออินเทอร์เน็ต

### ปัญหา: สถานะไม่แสดง
**สาเหตุที่เป็นไปได้:**
- ไม่มี `actual_in`/`actual_out`
- ไม่มี `plan_in`/`plan_out`
- เวลาต่างกันเกิน ±10 นาที

**วิธีแก้ไข:**
1. ตรวจสอบว่ามีข้อมูลครบถ้วนหรือไม่
2. ตรวจสอบว่าเช็คอินแล้วหรือยัง
3. ตรวจสอบว่าเวลาตรงกันหรือไม่

---

*เอกสารนี้สร้างจาก Screenshot วันที่ 25 ธันวาคม 2025*

